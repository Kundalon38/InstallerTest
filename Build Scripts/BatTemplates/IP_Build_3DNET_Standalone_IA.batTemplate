echo -Code Sign the Application EXEs
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\RISA3Dw.exe"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET_Demo\RISA3Dw.exe"

rem code sign Unbundled DLLS for RISA-3D
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.RISA3D.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.Presentation.DX.Contract.R3D.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.GlibRes.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.Presentation.DX.Contract.Common.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.Draw.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.Draw.R3D.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.CoreAccess.R3D.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\Interop.RISALicenseManagerCOMLib.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.CoreAccess.Contract.Common.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.CoreAccess.Contract.R3D.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\RISA-3D\RISAtech.CalatravaLink.Contract.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\SAF-3D\RISAtech.CalatravaLink.Contract.dll"
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET\bin\SAF-3D\RISAtech.CalatravaLink.dll"

echo -Delete the Release Folders in Project Files
rmdir /Q /S "C:\InstallAware\Project Files\RISA-3D_dotNET\Standalone\Release"

echo -Delete the Installation Package
del %IP_EditInstallerOutputFile

rem robocopy switches, show: /Xtras | /TimeStamp | /FullPath | /NoProgress | /Verbose | /E copy subdirs | /MIR	Mirrors a directory tree (equivalent to /e plus /purge)

echo -Copying Common Source Files
robocopy "C:\InstallAware\Source Files\Common Files\Databases" "C:\InstallAware\Source Files\Common Files\DatabasesBAK" /X /TS /FP /NP /V
erase /Q "C:\InstallAware\Source Files\Common Files\Databases\*.*"

robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\CFS Schedules" "C:\InstallAware\Source Files\Common Files\CFS Schedules" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Databases" "C:\InstallAware\Source Files\Common Files\Databases" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Database Utilities" "C:\InstallAware\Source Files\Common Files\Database Utilities" *.exe /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Design Lists" "C:\InstallAware\Source Files\Common Files\Design Lists" *.asc /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Detail Reports" "C:\InstallAware\Source Files\Common Files\Detail Reports" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\DXF" "C:\InstallAware\Source Files\Common Files\DXF" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\INI" "C:\InstallAware\Source Files\Common Files\INI" *.ini /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Library" "C:\InstallAware\Source Files\Common Files\Library" *.dll /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\License\Utilities" "C:\InstallAware\Source Files\Common Files\License\Utilities" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\LC_lists" "C:\InstallAware\Source Files\Common Files\LC_lists" *.xml /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Manuals" "C:\InstallAware\Source Files\Common Files\Manuals" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\RISA_Wood_Schedules" "C:\InstallAware\Source Files\Common Files\RISA_Wood_Schedules" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\SAF" "C:\InstallAware\Source Files\Common Files\SAF" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Silent Install" "C:\InstallAware\Source Files\Common Files\Silent Install" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\Common Files\Yield Links" "C:\InstallAware\Source Files\Common Files\Yield Links" /e   /X /TS /FP /NP /V

robocopy "G:\Shared drives\Tech\Installer Staging\RISA Key Manager" "C:\InstallAware\Source Files\RISA Key Manager" /e /X /TS /FP /NP /V
rmdir "C:\InstallAware\Source Files\RISA License Manager" /s /q
robocopy "G:\Shared drives\Tech\Installer Staging\RISA License Manager" "C:\InstallAware\Source Files\RISA License Manager" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Tech\Installer Staging\SafeNet\Sentinel RMS" "C:\InstallAware\Source Files\SafeNet\Sentinel RMS" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Tech\Installer Staging\SafeNet\Sentinel System Driver" "C:\InstallAware\Source Files\SafeNet\Sentinel System Driver" /e /X /TS /FP /NP /V

echo -Copying RISA-3D Source Files
rem for file renames, use copy, not xcopy; xcopy will ask if this is a file or a directory, no way to shut it off

rem 17-Mar-21 changed /E to /MIR for RISA-3D_dotNET\Exes
robocopy "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET" "C:\InstallAware\Source Files\RISA-3D_dotNET\Exes" /MIR /X /TS /FP /NP /V 
robocopy "G:\Shared drives\Tech\Installer Staging\RISA-3D_dotNET_Demo" "C:\InstallAware\Source Files\RISA-3D_dotNET\Exes\DemoBackup" /MIR /X /TS /FP /NP /V 
copy "G:\Shared drives\Tech\Installer Staging\RISA-3D17\risa3dw.exe" "C:\InstallAware\Source Files\RISA-3D_dotNET\Exes\risa3dw17.exe"  /y


robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Examples" "C:\InstallAware\Source Files\RISA-3D\Examples" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Help" "C:\InstallAware\Source Files\RISA-3D\Help"  /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Install Support Files" "C:\InstallAware\Project Files\RISA-3D\Demo" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Install Support Files" "C:\InstallAware\Project Files\RISA-3D\Standalone" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Manuals" "C:\InstallAware\Source Files\RISA-3D\Manuals" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Region Defaults" "C:\InstallAware\Source Files\RISA-3D\Region Defaults" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Release Notes" "C:\InstallAware\Source Files\RISA-3D\Release Notes" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Silent Install" "C:\InstallAware\Source Files\RISA-3D\Silent Install" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\Tutorials" "C:\InstallAware\Source Files\RISA-3D\Tutorials" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Examples" "C:\InstallAware\Source Files\RISAFoundation\Examples" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Help" "C:\InstallAware\Source Files\RISAFoundation\Help"  /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Install Support Files" "C:\InstallAware\Project Files\RISAFoundation\Demo" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Install Support Files" "C:\InstallAware\Project Files\RISAFoundation\Standalone" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Manuals" "C:\InstallAware\Source Files\RISAFoundation\Manuals" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Region Defaults" "C:\InstallAware\Source Files\RISAFoundation\Region Defaults" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Release Notes" "C:\InstallAware\Source Files\RISAFoundation\Release Notes" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Silent Install" "C:\InstallAware\Source Files\RISAFoundation\Silent Install" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Tutorials" "C:\InstallAware\Source Files\RISAFoundation\Tutorials" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISA-3D\STAAD" "C:\InstallAware\Source Files\RISA-3D\STAAD" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Tech\Installer Staging\RISAFloor" "C:\InstallAware\Source Files\RISAFloor\Exes" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Examples" "C:\InstallAware\Source Files\RISAFloor\Examples" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Help" "C:\InstallAware\Source Files\RISAFloor\Help" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Install Support Files" "C:\InstallAware\Project Files\RISAFloor\Demo" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Install Support Files" "C:\InstallAware\Project Files\RISAFloor\Standalone" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Manuals" "C:\InstallAware\Source Files\RISAFloor\Manuals" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Region Defaults" "C:\InstallAware\Source Files\RISAFloor\Region Defaults" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Release Notes" "C:\InstallAware\Source Files\RISAFloor\Release Notes" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\RISA_Decks" "C:\InstallAware\Source Files\RISAFloor\RISA_Decks" *.xml /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Silent Install" "C:\InstallAware\Source Files\RISAFloor\Silent Install" /e /X /TS /FP /NP /V
robocopy "G:\Shared drives\Support Team\Install Sources\RISAFloor\Tutorials" "C:\InstallAware\Source Files\RISAFloor\Tutorials" /e /X /TS /FP /NP /V

copy "G:\Shared drives\Support Team\Install Sources\Common Files\Install Screens\install_splash_3d.bmp" "C:\InstallAware\Project Files\RISA-3D\Demo\Setup.bmp" /y 
copy "G:\Shared drives\Support Team\Install Sources\Common Files\Install Screens\install_splash_3d.bmp" "C:\InstallAware\Project Files\RISA-3D\Standalone\Setup.bmp" /y 

robocopy "G:\Shared drives\Support Team\Install Sources\RISAFoundation\Help" "C:\InstallAware\Source Files\RISAFoundation\Help" risafnd.chm /X /TS /FP /NP /V

time /t

echo -Building RISA-3D Standalone Install-

miabuild.exe %IP_EditInstallerScriptFile /b=1 >%IP_EditInstallerLogFile
rem Uncompressed
rem miabuild.exe %IP_EditInstallerScriptFile /b=0 >%IP_EditInstallerLogFile
robocopy "C:\InstallAware\Project Files\RISA-3D_dotNET\Standalone\Release\Single" %IP_EditInstallerOutputDir *.exe  /X /TS /FP /NP /V
signtool.exe sign /a /s my /fd sha256 /tr http://timestamp.digicert.com /v %IP_EditInstallerOutputFile

robocopy %IP_EditInstallerOutputDir *.exe %IP_EditInstallerPublishDir /X /TS /FP /NP /V
time /t